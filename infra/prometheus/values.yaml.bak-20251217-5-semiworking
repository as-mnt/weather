# Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ server.config â€” Ğ¾Ğ½ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ÑƒĞµÑ‚ Ñ serverFiles
server:
  persistentVolume:
    enabled: false
  retention: "6h"
  global:
    scrape_interval: 30s
#    resolve_timeout: 5m

# Alertmanager â€” Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
alertmanager:
  enabled: true
  persistentVolume:
    enabled: true
    size: 2Gi
    storageClass: ""
  alertmanagerSpec:
    config:
      global:
        resolve_timeout: 5m
      route:
        receiver: 'telegram'
        group_by: ['alertname']
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 1h
      receivers:
        - name: 'telegram'
          webhook_configs:
            - url: 'http://telegram-proxy:8080/alert'
              send_resolved: true

# Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
serverFiles:
  # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ Prometheus
  prometheus.yml:
    rule_files:
#      - /etc/prometheus/rules.yml
      - /etc/prometheus/rules.d/*.yml
    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']
      - job_name: 'telegraf'
        static_configs:
          - targets: ['telegraf:9273']
        scrape_interval: 30s

additionalRulesMap:
  weather-alerts: |
    groups:
    - name: weather-alerts
      rules:
        - alert: NoDataFromTelegraf
          expr: absent(weather_temperature_2m{job="telegraf"}) or changes(weather_temperature_2m{job="telegraf"}[10m]) == 0
          for: 15m
          labels:
            severity: critical
          annotations:
            summary: "âš ï¸ ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾Ñ‚ Telegraf Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚"

        - alert: HighPM25
          expr: pollution_components_pm2_5{job="telegraf"} > 25
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: "ğŸŒ«ï¸ Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ PM2.5: {{ $value }} Ğ¼ĞºĞ³/Ğ¼Â³ (Ğ½Ğ¾Ñ€Ğ¼Ğ° â‰¤ 25)"

#  # ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ°Ğ»ĞµÑ€Ñ‚Ğ¸Ğ½Ğ³Ğ°
#  rules.yml:
#    groups:
#      - name: weather-alerts
#        rules:
#          - alert: NoDataFromTelegraf
#            expr: absent(weather_temperature_2m{job="telegraf"}) or changes(weather_temperature_2m{job="telegraf"}[10m]) == 0
#            for: 15m
#            labels:
#              severity: critical
#            annotations:
#              summary: "âš ï¸ ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾Ñ‚ Telegraf Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚"
#
#          - alert: HighPM25
#            expr: pollution_components_pm2_5{job="telegraf"} > 25
#            for: 10m
#            labels:
#              severity: warning
#            annotations:
#              summary: "ğŸŒ«ï¸ Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ PM2.5: {{ $value }} Ğ¼ĞºĞ³/Ğ¼Â³ (Ğ½Ğ¾Ñ€Ğ¼Ğ° â‰¤ 25)"
