serverFiles:
  # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥
  prometheus.yml:
    global:
      scrape_interval: 30s
    rule_files:
      - /etc/config/weather-alerts.yaml  # ‚Üê —Ñ–∞–π–ª –±—É–¥–µ—Ç –≤ /etc/config/
    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']
      - job_name: 'telegraf'
        static_configs:
          - targets: ['telegraf:9273']
        scrape_interval: 30s

  # –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ (–ø—Ä–æ—Å—Ç–æ —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ)
  weather-alerts.yaml: |
    groups:
    - name: weather-alerts
      rules:
      - alert: NoDataFromTelegraf
        expr: absent(weather_temperature_2m{job="telegraf"}) or changes(weather_temperature_2m{job="telegraf"}[10m]) == 0
        for: 15m
        labels:
          severity: critical
        annotations:
          summary: "‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegraf –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –º–∏–Ω—É—Ç"
      - alert: HighPM25
        expr: pollution_components_pm2_5{job="telegraf"} > 25
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "üå´Ô∏è –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å PM2.5: {{ $value }} –º–∫–≥/–º¬≥ (–Ω–æ—Ä–º–∞ ‚â§ 25)"

server:
  persistentVolume:
    enabled: false
  retention: "6h"

alertmanager:
  enabled: true
  persistentVolume:
    enabled: true
    size: 2Gi
    storageClass: ""
  alertmanagerSpec:
    config:
      global:
        resolve_timeout: 5m
      route:
        receiver: 'telegram'
        group_by: ['alertname']
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 1h
      receivers:
        - name: 'telegram'
          webhook_configs:
            - url: 'http://telegram-proxy:8080/alert'
              send_resolved: true
