# Prometheus Server
serverFiles:
  prometheus.yml:
    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']
      - job_name: 'telegraf'
        static_configs:
          - targets: ['telegraf:9273']
        scrape_interval: 30s

server:
  persistentVolume:
    enabled: false
  retention: "6h"
  config:
    scrape_configs:
      - job_name: 'telegraf'
        static_configs:
          - targets: ['telegraf:9273']
#        kubernetes_sd_configs:
#          - role: pod
#        relabel_configs:
#          # Оставляем только Pod'ы в namespace=default
#          - source_labels: [__meta_kubernetes_namespace]
#            action: keep
#            regex: default
#          # Оставляем только Pod'ы с label app.kubernetes.io/name=telegraf
#          #          - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_name]
#          # Используем instance=label релиза Helm
#          - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_instance]            
#            action: keep
#            regex: telegraf
#          # Устанавливаем порт 9273
#          - source_labels: [__address__]
#            action: replace
#            target_label: __address__
#            replacement: $1:9273
#          # Устанавливаем имя job'а
#          - action: replace
#            target_label: job
#            replacement: telegraf
        scrape_interval: 30s
        metrics_path: /metrics

# Alertmanager
alertmanager:
  enabled: true
  persistentVolume:
     enabled: true
     size: 2Gi
     storageClass: ""  # без StorageClass — будет использовать ваш PV
  alertmanagerSpec:
    config:
      global:
        resolve_timeout: 5m
      route:
        receiver: 'telegram'
        group_by: ['alertname']
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 1h
      receivers:
        - name: 'telegram'
          webhook_configs:
            - url: 'http://telegram-proxy:8080/alert'
              send_resolved: true
